<source>
  @type tail
  @id input1
  path /var/log/idp/sample.log
  pos_file /fluentd/log/td-agent/sample.log.pos
  tag sample
  <parse>
    @type regexp
    expression /^(?<application>[^;]*);(?<logfile>[^;]*);(?<env>[^;]*);(?<reserved>[^;]*);(?<message>.*)$/
  </parse>
</source>

<match sample>
  @type rewrite_tag_filter
  <rule>
    key logfile
    pattern /^idp-([a-z]+)\.log$/
    tag idp_$1_log
  </rule>
  <rule>
    key logfile
    pattern /^catalina\.out$/
    tag tomcat_catalina_out
  </rule>
  <rule>
    key logfile
    pattern /^localhost\.log$/
    tag tomcat_localhost_log
  </rule>
  <rule>
    key logfile
    pattern /^console$/
    tag tomcat_console_log
  </rule>
</match>

<match idp_process_log>
  @type file
  path /fluentd/log/shib-idp/idp-process.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match idp_audit_log>
  @type file
  path /fluentd/log/shib-idp/idp-audit.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match idp_warn_log>
  @type file
  path /fluentd/log/shib-idp/idp-warn.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match tomcat_catalina_out>
  @type file
  path /fluentd/log/tomcat/catalina.out
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match tomcat_localhost_log>
  @type file
  path /fluentd/log/tomcat/localhost.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match tomcat_console_log>
  @type file
  path /fluentd/log/tomcat/console.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match fluentd.*>
  @type stdout
</match>
