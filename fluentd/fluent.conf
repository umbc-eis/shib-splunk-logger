<source>
  @type tail
  @id input1
  path /var/log/idp/sample.log
  pos_file /fluentd/log/td-agent/sample.log.pos
  tag sample
  <parse>
    @type regexp
    expression /^(?<application>[^;]*);(?<logfile>[^;]*);(?<env>[^;]*);(?<reserved>[^;]*);(?<message>.*)$/
  </parse>
</source>

<match sample>
  @type rewrite_tag_filter
  <rule>
    key logfile
    pattern /^idp-process\.log$/
    tag idp_process_log
  </rule>
  <rule>
    key logfile
    pattern /^idp-audit\.log$/
    tag idp_audit_log
  </rule>
  <rule>
    key logfile
    pattern /^idp-warn\.log$/
    tag idp_warn_log
  </rule>
</match>

<match idp_process_log>
  @type file
  path /fluentd/log/idp-process.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match idp_audit_log>
  @type file
  path /fluentd/log/idp-audit.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match idp_warn_log>
  @type file
  path /fluentd/log/idp-warn.log
  <format>
    @type single_value
    message_key message
  </format>
  <buffer>
    flush_mode immediate
  </buffer>
</match>

<match fluentd.*>
  @type stdout
</match>
